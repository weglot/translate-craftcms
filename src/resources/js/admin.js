!function(){const e=document.querySelector("[data-weglot-api-key]"),t=document.querySelector("[data-weglot-api-status]"),n=e?e.closest("form"):null;let i=!(!e||""===e.value.trim())&&null,s=null;function a(e,n){if(!t)return;s&&(clearTimeout(s),s=null);const i=e?"green":"#B91C1C";t.innerHTML='<span style="color:'+i+';">'+(n||"")+"</span>",t.classList.add("show")}function o(){t&&(t.classList.remove("show"),setTimeout(function(){t.innerHTML=""},300))}function l(){if(!n)return;const e=n.querySelector('button[type="submit"], .btn.submit');e&&(!1===i?(e.classList.add("disabled"),e.disabled=!0):(e.classList.remove("disabled"),e.disabled=!1))}function r(e){return t?e&&e.trim()?(t.textContent=Craft.t("weglot","Checking..."),new Promise(function(t){Craft.postActionRequest("weglot/api/validate-api-key",{apiKey:e},function(e,n){const i=document.getElementById("settings-apiKey");if("success"!==n)return a(!1,Craft.t("weglot","Communication error with the server.")),i&&(i.classList.remove("is-valid"),i.classList.add("is-invalid")),t(!1);const l=!(e.error||e.succeeded&&1!==parseInt(e.succeeded));l?(a(!0,Craft.t("weglot","Success! The API key is valid.")),i&&(i.classList.add("is-valid"),i.classList.remove("is-invalid")),s=setTimeout(function(){o();const e=document.getElementById("settings-apiKey");e&&e.classList.remove("is-valid")},3e3)):(a(!1,e.message||e.error||Craft.t("weglot","The API key is invalid.")),i&&(i.classList.remove("is-valid"),i.classList.add("is-invalid"))),t(l)})})):(a(!1,Craft.t("weglot","Please enter an API key.")),Promise.resolve(!1)):Promise.resolve(!1)}function c(){var e=window.jQuery;if(e&&e.fn&&e.fn.selectize){var t=e("input.weglot-select-destination");if(t.length){var n=function(){var e=document.getElementById("weglot-list-languages");if(!e)return{languages:[],limit:0};try{var t=JSON.parse(e.textContent||"{}")||{};return Array.isArray(t.languages)||(t.languages=[]),"number"!=typeof t.limit&&(t.limit=0),t}catch(n){return{languages:[],limit:0}}}(),i=n.languages||[],s=n.limit>0?n.limit:0;t[0].selectize&&t[0].selectize.destroy();var a=i.map(function(e){return{internal_code:e.internal_code,english:e.english,local:e.local,external_code:e.external_code}});t.selectize({delimiter:"|",persist:!1,create:!1,openOnFocus:!0,closeAfterSelect:!1,hideSelected:!0,selectOnTab:!0,maxItems:s>0?s:null,maxOptions:1e3,diacritics:!0,valueField:"internal_code",labelField:"local",searchField:["internal_code","english","local"],sortField:[{field:"english",direction:"asc"}],options:a,plugins:["remove_button"],render:{option:function(e,t){return'<div class="weglot__choice__language"><span class="weglot__choice__language--local">'+t(e.local||"")+" ["+t(e.external_code||"")+"]</span></div>"},item:function(e,t){return"<div>"+t(e.local||e.internal_code||"")+"</div>"}},onInitialize:function(){var e=this;e.on("focus",function(){e.search(""),e.refreshOptions(!0),e.open()})}})[0].selectize}}}function d(){c(),setTimeout(function(){!function(){var e=document.getElementById("settings-weglot-box-first-settings");if(e){var t=e.querySelector(".weglot-btn-close");t&&t.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),i()}),e.addEventListener("click",function(t){t.target===e&&i()});var n=function(e){"Escape"===e.key&&(i(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n)}function i(){e.style.opacity="0",setTimeout(function(){e.remove()},200)}}()},100)}e&&e.addEventListener("input",function(){i=null,o(),l()}),document.addEventListener("focusout",function(t){t.target===e&&r(e.value).then(function(e){i=e,l()})}),n&&n.addEventListener("submit",function(t){if(!1===i)return t.preventDefault(),void(Craft.cp&&Craft.cp.displayError?Craft.cp.displayError(Craft.t("weglot","The API key is invalid.")):alert(Craft.t("weglot","The API key is invalid.")));null===i&&e&&(t.preventDefault(),r(e.value).then(function(e){i=e,l(),e?n.submit():Craft.cp&&Craft.cp.displayError?Craft.cp.displayError(Craft.t("weglot","The API key is invalid.")):alert(Craft.t("weglot","The API key is invalid."))}))}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),window.Garnish&&Garnish.$doc&&Garnish.$doc.on("pjax:end",function(){setTimeout(function(){d()},100)})}();
